{% extends "base.html" %}

{% block title %}Liste des Cartes Grises{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>

<h2>Liste des Cartes Grises</h2>

{% if cartes %}
<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>N° Carte</th>
                <th>Plaque</th>
                <th>Propriétaire</th>
                <th>Marque/Modèle</th>
                <th>VIN</th>
                <th>Date Immat.</th>
                <th>Permis</th>
                <th>Puissance (CV)</th>
                <th>Carburant</th>
                <th>Poids (kg)</th>
                <th>CO2 (g/km)</th>
                <th>Couleur</th>
                <th>Validité Cert.</th>
                <th>Prochain CT</th>
                <th>Classe Env.</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for carte in cartes %}
            <tr>
                <td><strong>{{ carte.numero_carte_grise }}</strong></td>
                <td><strong>{{ carte.numero_immatriculation[:2] }} {{ carte.numero_immatriculation[2:5] }} {{ carte.numero_immatriculation[5:] }}</strong></td>
                <td>{{ carte.nom }} {{ carte.prenom }}</td>
                <td>{{ carte.marque_nom }} {{ carte.modele }}</td>
                <td>{{ carte.numero_serie[:8] if carte.numero_serie else 'N/A' }}</td>
                <td>{{ carte.date_immat_actuelle.strftime('%d/%m/%Y') if carte.date_immat_actuelle else 'N/A' }}</td>
                <td>{{ carte.categorie_permis }}</td>
                <td>{{ carte.puissance_chevaux if carte.puissance_chevaux else 'N/A' }}</td>
                <td>{{ carte.carburant_energie if carte.carburant_energie else 'N/A' }}</td>
                <td>{{ carte.poids_vide_kg }} / {{ carte.poids_max_kg }}</td>
                <td>{{ carte.emission_co2_g_km if carte.emission_co2_g_km else 'N/A' }}</td>
                <td>{{ carte.couleur_principale if carte.couleur_principale else 'N/A' }}</td>
                <td>{{ carte.date_validite_certificat.strftime('%d/%m/%Y') if carte.date_validite_certificat else 'N/A' }}</td>
                <td>{{ carte.date_prochain_controle.strftime('%d/%m/%Y') if carte.date_prochain_controle else 'N/A' }}</td>
                <td>{{ carte.classe_environnementale if carte.classe_environnementale else 'N/A' }}</td>
                <td>
                    <div class="actions">
                        <a href="{{ url_for('edit_carte_grise', carte_id=carte.id) }}" class="btn btn-small"> Modifier</a>
                        <form method="POST" action="{{ url_for('delete_carte_grise', carte_id=carte.id) }}" class="actions-inline" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette carte grise?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" class="btn btn-danger btn-small"> Supprimer</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="info-box info-box-top">
    <strong>Total: {{ cartes|length }} carte(s) grise(s)</strong>
</div>
{% else %}
<div class="no-data">
    <p>Aucune carte grise dans la base de données.</p>
    <p>Cliquez sur "Nouvelle carte" pour ajouter la première carte grise!</p>
</div>
</head>
<body>
{% endif %}
{% endblock %}
