{% extends "base.html" %}

{% block title %}Nouvelle Carte Grise{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/style.css">
    <title>Création carte grise</title>
</head>
<body>
<h2> Nouvelle Carte Grise</h2>

<div class="info-box">
    <p><strong>Information:</strong> Les numéros de carte grise et de plaque d'immatriculation seront générés automatiquement.</p>
</div>

<form method="POST" action="{{ url_for('add_carte_grise') }}" novalidate>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    
    <h3 style="margin-top: 20px; color: var(--grey-color);">Informations du Véhicule</h3>
    
    <div class="form-row">
        <div class="form-group">
            <label for="modele_id">Marque et Modèle *</label>
            <select id="modele_id" name="modele_id" required>
                <option value="">-- Sélectionnez un modèle --</option>
                {% for modele in modeles %}
                <option value="{{ modele.id }}" {% if (selected_modele_id and selected_modele_id == (modele.id|string)) or (request.form.modele_id == (modele.id|string)) %}selected{% endif %}>{{ modele.marque_nom }} - {{ modele.modele }} ({{ modele.type_vehicule }})</option>
                {% endfor %}
                
            </select>
            <button type="submit" name="btn_load" class="btn btn-load-right">Charger modèle</button>
        </div>
        
        <div class="form-group">
            <label for="date_premiere_immat">Date de Première Immatriculation *</label>
            <input type="date" id="date_premiere_immat" name="date_premiere_immat" required min="2020-01-01" max="2026-12-31">
        </div>
        
        <div class="form-group">
            <label for="numero_serie">Numéro VIN</label>
            <input type="text" id="numero_serie" name="numero_serie" maxlength="30" placeholder="VIN (généré automatiquement si vide)" 
                   value="{{ prefilled.numero_serie if prefilled else request.form.numero_serie or '' }}">
            <small style="color: var(--grey-color);">Le numéro VIN sera généré automatiquement si ce champ est laissé vide</small>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="poids_vide">Poids à vide (kg) *</label>
            <input type="number" id="poids_vide" name="poids_vide" required min="100" placeholder="1200"
                   value="{{ prefilled.poids_vide if prefilled else request.form.poids_vide or '' }}">
        </div>
        
        <div class="form-group">
            <label for="poids_max">Poids maximal (kg) *</label>
            <input type="number" id="poids_max" name="poids_max" required min="100" placeholder="1800"
                   value="{{ prefilled.poids_max if prefilled else request.form.poids_max or '' }}">
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="categorie_permis">Catégorie de Permis *</label>
            <select id="categorie_permis" name="categorie_permis" required>
                <option value="">-- Sélectionnez --</option>
                {% set selected_permis = prefilled.categorie_permis if prefilled else request.form.categorie_permis %}
                <option value="A1" {% if selected_permis == 'A1' %}selected{% endif %}>A1 - Moto légère</option>
                <option value="A2" {% if selected_permis == 'A2' %}selected{% endif %}>A2 - Moto moyenne</option>
                <option value="A"  {% if selected_permis == 'A' %}selected{% endif %}>A - Moto</option>
                <option value="B"  {% if selected_permis == 'B' %}selected{% endif %}>B - Automobile</option>
                <option value="C"  {% if selected_permis == 'C' %}selected{% endif %}>C - Camion léger</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="carburant_energie">Carburant/Énergie *</label>
            <select id="carburant_energie" name="carburant_energie">
                <option value="">-- Sélectionnez --</option>
                {% set selected_carburant = prefilled.carburant_energie if prefilled else request.form.carburant_energie %}
                <option value="Essence" {% if selected_carburant == 'Essence' %}selected{% endif %}>Essence</option>
                <option value="Diesel" {% if selected_carburant == 'Diesel' %}selected{% endif %}>Diesel</option>
                <option value="Électrique" {% if selected_carburant == 'Électrique' %}selected{% endif %}>Électrique</option>
                <option value="Hybride" {% if selected_carburant == 'Hybride' %}selected{% endif %}>Hybride</option>
                <option value="GPL" {% if selected_carburant == 'GPL' %}selected{% endif %}>GPL</option>
                <option value="GNV" {% if selected_carburant == 'GNV' %}selected{% endif %}>GNV</option>
                <option value="Éthanol" {% if selected_carburant == 'Éthanol' %}selected{% endif %}>Éthanol</option>
            </select>
        </div>
    

    <div class="form-row">
            <label for="places_assises">Nombre de places assises*</label>
            <input type="number" id="places_assises" name="places_assises" min="1" max="50" placeholder="5"
                   value="{{ prefilled.places_assises if prefilled else request.form.places_assises or '' }}">
        </div>
    </div>

    <h3 style="margin-top: 20px; color: var(--grey-color);">Caractéristiques Techniques </h3>

    <div class="form-row">
        <div class="form-group">
            <label for="cylindree">Cylindrée (cm³)*</label>
            <input type="number" id="cylindree" name="cylindree" min="0" placeholder="1560"
                   value="{{ prefilled.cylindree if prefilled else request.form.cylindree or '' }}">
        </div>
        
        <div class="form-group">
            <label for="puissance_chevaux">Puissance (chevaux)*</label>
            <input type="number" id="puissance_chevaux" name="puissance_chevaux" min="0" placeholder="130"
                   value="{{ prefilled.puissance_chevaux if prefilled else request.form.puissance_chevaux or '' }}">
        </div>
    </div>
    
    <div class="form-group">
        <label for="emission_co2">Émission CO2 (g/km)*</label>
        <input type="number" id="emission_co2" name="emission_co2" min="0" placeholder="110"
               value="{{ prefilled.emission_co2 if prefilled else request.form.emission_co2 or '' }}">
    </div>
    
    <div class="form-group">
        <label for="classe_environnementale">Classe Environnementale</label>
        <input type="text" id="classe_environnementale" name="classe_environnementale" placeholder="Euro 6"
               value="{{ prefilled.classe_environnementale if prefilled else request.form.classe_environnementale or '' }}">
    </div>
    
    <div class="form-group">
        <label for="couleur_principale">Couleur Principale</label>
        <input type="text" id="couleur_principale" name="couleur_principale" placeholder="Blanc"
               value="{{ prefilled.couleur_principale if prefilled else request.form.couleur_principale or '' }}">
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="puissance_administrative_cv">Puissance Administrative (CV)</label>
            <input type="number" id="puissance_administrative_cv" name="puissance_administrative_cv" min="0" placeholder="7"
                   value="{{ prefilled.puissance_administrative_cv if prefilled else request.form.puissance_administrative_cv or '' }}">
        </div>
        
        <div class="form-group">
            <label for="places_debout">Places Debout</label>
            <input type="number" id="places_debout" name="places_debout" min="0" max="50" placeholder="0"
                   value="{{ prefilled.places_debout if prefilled else request.form.places_debout or '' }}">
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="niveau_sonore_db">Niveau Sonore à l'arrêt (dB)</label>
            <input type="number" id="niveau_sonore_db" name="niveau_sonore_db" min="0" placeholder="75"
                   value="{{ prefilled.niveau_sonore_db if prefilled else request.form.niveau_sonore_db or '' }}">
        </div>
        
        <div class="form-group">
            <label for="vitesse_max_moteur_rpm">Vitesse Max. Moteur (tr/min)</label>
            <input type="number" id="vitesse_max_moteur_rpm" name="vitesse_max_moteur_rpm" min="0" placeholder="6500"
                   value="{{ prefilled.vitesse_max_moteur_rpm if prefilled else request.form.vitesse_max_moteur_rpm or '' }}">
        </div>
    </div>
    
    <h3 style="margin-top: 20px; color: var(--grey-color);">Validité et Contrôles</h3>
    
    <div class="form-row">
        <div class="form-group">
            <label for="date_fin_validite">Date de fin de validité</label>
            <input type="date" id="date_fin_validite" name="date_fin_validite">
        </div>
        
        <div class="form-group">
            <label for="date_validite_certificat">Date de Validité du Certificat</label>
            <input type="date" id="date_validite_certificat" name="date_validite_certificat">
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="date_premier_controle">Premier Contrôle Technique</label>
            <input type="date" id="date_premier_controle" name="date_premier_controle">
        </div>
        
        <div class="form-group">
            <label for="date_prochain_controle">Prochain Contrôle Technique</label>
            <input type="date" id="date_prochain_controle" name="date_prochain_controle">
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="date_controle_2">Contrôle Technique 2</label>
            <input type="date" id="date_controle_2" name="date_controle_2">
        </div>
        
        <div class="form-group">
            <label for="date_controle_3">Contrôle Technique 3</label>
            <input type="date" id="date_controle_3" name="date_controle_3">
        </div>
    </div>
 
 <h3 style="margin-top: 20px; color: var(--grey-color);">Informations du Propriétaire</h3>
    
    <div class="form-row">
        <div class="form-group">
            <label for="nom">Nom *</label>
            <input type="text" id="nom" name="nom" required placeholder="Dupont">
        </div>
        
        <div class="form-group">
            <label for="prenom">Prénom *</label>
            <input type="text" id="prenom" name="prenom" required placeholder="Jean">
        </div>
    </div>
    
    <div class="form-group">
        <label for="adresse">Adresse *</label>
        <input type="text" id="adresse" name="adresse" required placeholder="15 Rue de la Paix, 75001 Paris">
    </div>

    
    <div class="actions" style="margin-top: 30px;">
        <button type="submit" name="btn_save" class="btn btn-success"> Créer la Carte Grise</button>
        <a href="{{ url_for('index') }}" class="btn btn-secondary"> Annuler</a>
    </div>
</form>

</body>
</html>

{% endblock %}
